#!/usr/bin/env sh
## { alterEGO Linux: "Open the vault of knowledge" } ----------------------- ##
##                                                                           ##
## ~/.alterEGO/.egorc                                                        ##
##   created     : 2021-03-19 09:37:19 UTC                                   ##
##   updated     : 2021-12-11 11:09:26 UTC                                   ##
##   description : Additional shell stuff for alterEGO Linux.                ##
## _________________________________________________________________________ ##

## [ COLORS ] -------------------------------------------------------------- ##

  export TERM="xterm-256color"

  export COLOR_BLUE="\033[34m"
  export COLOR_BOLD="\033[1m"
  export COLOR_GREEN="\033[32m"
  export COLOR_RED="\033[31m"
  export COLOR_RESET="\033[0m"

## [ ALIAS ] --------------------------------------------------------------- ##

  alias msfconsole='msfconsole -x "db_connect ${USER}@msf"'

## [ DEFAULT APPLICATIONS ] ------------------------------------------------ ##

  export BROWSER=firefox
  export FZF_DEFAULT_COMMAND='rg --files --hidden '
  export TERMINAL="xfce4-terminal --hide-scrollbar --hide-menubar --hide-toolbar"
  export VISUAL=vim
  export EDITOR=${VISUAL}

## [ PATH ] ---------------------------------------------------------------- ##

  ##### ref. https://www.linuxjournal.com/content/removing-duplicate-path-entries

  PATH="${PATH}:${HOME}/fH/scripts:${HOME}/droid/scripts:${HOME}/scripts:${HOME}/bin"
  PATH=$(printf '%s' "${PATH}" | awk -v RS=: '!($0 in a) {a[$0]; printf("%s%s", length(a) > 1 ? ":" : "", $0)}')

  export PATH

## [ VIM ] ----------------------------------------------------------------- ##

  ##### Enable CTRL+s and CTRL+q in vim.
  stty -ixon

## [ QT5 ] ----------------------------------------------------------------- ##

  ##### https://wiki.manjaro.org/index.php/Set_all_Qt_app%27s_to_use_GTK%2B_font_%26_theme_settings
  ##... Set all Qt app's to use GTK+ font & theme settings
  ##... Overview
  ##... When using a Desktop Environment or Window Manager that doesn't allow for the settings of QT themes,
  ##... you can set QT to use your GTK themes instead.
  ##... Using qt5ct
  ##... note: In some Manjaro editions, this is already done for you by default
  ##... Install qt5ct using your favorite package manager or the command:
  ##... pamac install qt5ct
  ##... Set environment variables in ~/.profile by adding or updating the following lines:
  ##... export QT_QPA_PLATFORMTHEME="qt5ct"
  ##... Run the application QT5 Configuration Manager from the menu or run the command qt5ct.
  ##... Logout and login again to make the change effective

  # export QT_QPA_PLATFORMTHEME="qt5ct"

## [ WORDLISTS ] ----------------------------------------------------------- ##

  export WORDLISTS="/usr/local/share/wordlists"
  export WL_BEST1050="${WORDLISTS}/best1050.txt"
  export WL_BIG="${WORDLISTS}/seclist-big.txt"
  export WL_DIRMEDIUM="${WORDLISTS}/directory-list-2.3-medium.txt"
  export WL_ROCKYOU="${WORDLISTS}/rockyou.txt"
  export WL_LARGEFILES="${WORDLISTS}/raft-large-files.txt"
  export WL_XPLATFORM="${WORDLISTS}/xplatform.txt"

## [ REVERSE SHELLS ] ------------------------------------------------------ ##

  export REVSHELLS="/usr/local/share/reverse_shells"
  export RS_PATT_NODEJS="${REVSHELLS}/patt_nodeJS.js"
  export RS_REVSHELL_PHP="${REVSHELLS}/php-reverse-shell.php"
  export RS_WEBSHELL="${REVSHELLS}/webshell.php"

## [ IP ADDRESSES ] -------------------------------------------------------- ##

  ipaddr() {

    ##### IP addresses will be exported when .egorc is sourced with the
    ##... function call, but can also be 'refreshed' when calling ipaddr
    ##... from the terminal (ex. after starting a VPN connection).

    ##### `host` is provided by the package 'bind'.
    IPPUB="$(host myip.opendns.com resolver1.opendns.com               \
                    | grep --color=never -oP '(?<=myip.opendns.com has address ).*$')"
    export IPPUB

    IPLOC="$(ip address | grep --color=never -oP "(?<=inet ).*(?=/.*enp)")"
    export IPLOC

    # printf "%s\n" "LAN IP:     ${IPLOC}"
    # printf "%s\n" "Public IP:  ${IPPUB}"
  }
  ipaddr

## [ PROMPTS ] ------------------------------------------------------------- ##

  prompt_command() {
      history -a
      dateNOW="$(date "+%F %H:%M:%S %Z")"
      #### tty won't show unicode character #10095.
      if tty | grep pts &>/dev/null; then

          ## ( SIMPLE )
          # export PS1='[\u@\h \W]\$ '
          
          ## ( KALI STYLE )
          # export PS1="\[${COLOR_RESET}\]\[${COLOR_GREEN}\]┌────(\[${COLOR_RESET}\]\u@\h\[${COLOR_GREEN}\])-[\[${COLOR_RESET}\]\w\[${COLOR_GREEN}\]]\n\[${COLOR_GREEN}\]└─$ \[${COLOR_RESET}\]"

          ## ( EGO )
          export PS1="\[${COLOR_RESET}\]\[${COLOR_GREEN}\](\u@\h)-[\[${COLOR_RESET}\]\w\[${COLOR_GREEN}\]] • \[$dateNOW\]\n\[${COLOR_GREEN}\]❯ \[${COLOR_RESET}\]"
      else

          ## ( SIMPLE )
          # export PS1='[\u@\h \W]\$ '
          
          ## ( KALI STYLE )
          # export PS1="\[${COLOR_RESET}\]\[${COLOR_GREEN}\]┌────(\[${COLOR_RESET}\]\u@\h\[${COLOR_GREEN}\])-[\[${COLOR_RESET}\]\w\[${COLOR_GREEN}\]]\n\[${COLOR_GREEN}\]└─$ \[${COLOR_RESET}\]"

          ## ( EGO )
          export PS1="\[${COLOR_RESET}\]\[${COLOR_GREEN}\](\u@\h)-[\[${COLOR_RESET}\]\w\[${COLOR_GREEN}\]] • \[$dateNOW\]\n\[${COLOR_GREEN}\]> \[${COLOR_RESET}\]"
      fi
  }

  PROMPT_COMMAND=prompt_command

## [ GOTO ] ---------------------------------------------------------------- ##

  ##### Requires: bash-completion && sourced in .bashrc
  ##... Usage: `goto @mounted`
  ##... To add a goto link:
  ##... `ln -s /some/directory/path @goto-link` in $HOME/.alterEGO/.goto directory.
  ##... src. https://threkk.medium.com/how-to-use-bookmarks-in-bash-zsh-6b8074e40774
  ##... src. https://twitter.com/mattn_jp/status/1434192554036137995

  if [ -d "${HOME}/.alterEGO/.goto/" ]; then
    export CDPATH=".:${HOME}/.alterEGO/.goto:/"
    alias goto="cd -P"
    _goto() {
      local IFS=$'\n'
      COMPREPLY=( $(compgen -W "$(/bin/ls ~/.alterEGO/.goto)" -- ${COMP_WORDS[COMP_CWORD]}) )
    } && complete -F _goto goto
  fi

## [ TryHackMe ] ----------------------------------------------------------- ##

  alias attack=". ${HOME}/.alterEGO/.tryhackmerc"

## [ Damn Vulnerable Web App (DVWA) ] -------------------------------------- ##

  dvwa() {
      ##### Will install or run the Damn Vulnerable Web App (DVWA) docker.
      if [[ "$1" == 'start' ]]; then
        docker666 start
        docker run --rm -it -p 81:80 vulnerables/web-dvwa &
        sleep 2
        $BROWSER "http://localhost:81/login.php"
      elif [[ "$1" == 'stop' ]]; then
        docker stop $(docker ps | grep "vulnerables/web-dvwa" | cut -d ' ' -f1)
        docker666 stop
      else
        cat <<EOF
Usage: dvwa [start|stop]
EOF
      fi
      }

## [ OWASP JUICE SHOP ] ---------------------------------------------------- ##

  juiceShop() {
    ##### Will install or run the OWASP Juice Shop docker.
    if [[ "$1" == 'start' ]]; then
      docker666 start
      docker run --rm -p 3000:3000 bkimminich/juice-shop &
      sleep 2
      $BROWSER "http://localhost:3000"
    elif [[ "$1" == 'stop' ]]; then
      docker stop $(docker ps | grep "bkimminich/juice-shop" | cut -d ' ' -f1)
      docker666 stop
    else
      cat <<EOF
Usage: juiceShop [start|stop]
EOF
    fi
  }

  kali() {
    docker666 start
    if [[ -z $(docker ps -a | awk '/kali/ { print $NF }') ]]; then
      docker run --name kali --net="host" --privileged -e DISPLAY=$DISPLAY -it -v /tmp/.X11-unix:/tmp/.X11-unix kalilinux/kali-rolling /bin/bash
    else
      if [[ -z "$(docker ps | grep kali$)" ]]; then
        docker start -i kali
      else
        printf '%b\n' "${COLOR_RED}[!]${COLOR_RESET} ${COLOR_BOLD}Kali is already running...${COLOR_RESET}"
      fi
    fi
  }

## [ LOADED ] -------------------------------------------------------------- ##

  loadedEgorc() {
    printf "${COLOR_GREEN}[+]${COLOR_RESET} ${COLOR_BOLD}.egorc loaded @ $(date | sed 's/  / /g')...${COLOR_RESET}\n"
  }
  # loadedEgorc

## [ RELOAD ] -------------------------------------------------------------- ##

  reloadEgorc() {
    . "${HOME}/.alterEGO/.egorc"
    loadedEgorc
  }

## FIN _____________________________________________________________ ¯\_(ツ)_/¯
